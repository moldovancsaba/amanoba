# Run Log — PRODUCTIVITY_2026_EN — Quiz Quality Audit (Dry Run)

- Started (UTC): 2026-01-26T23-09-28Z
- Course: PRODUCTIVITY_2026_EN
- Language: en
- CCS: docs/canonical/PRODUCTIVITY_2026/PRODUCTIVITY_2026.canonical.json
- Baseline commit (local): 9d9510e

## Safety Rollback Plan

### If we later APPLY DB changes and something is wrong
Restore a lesson quiz from a backup JSON (per-lesson):

- Command:

  npx tsx --env-file=.env.local scripts/restore-lesson-quiz-from-backup.ts --file scripts/quiz-backups/PRODUCTIVITY_2026_EN/<BACKUP_FILE>.json

- Verify:
  - Use admin UI quiz view, or
  - Run scripts/review-questions-by-lesson.ts for spot checks.

### If we change code/docs and need to roll back
- Revert local working tree changes:

  git checkout -- .

- Hard reset to baseline commit:

  git reset --hard 9d9510e

## Phase 1 — Lesson Quality Audit (read-only)
- Command:

  npx tsx --env-file=.env.local scripts/audit-lesson-quality.ts --course PRODUCTIVITY_2026_EN --min-score 70

- Output:
  - JSON: scripts/reports/lesson-quality-audit__2026-01-26T23-14-45-939Z.json
  - Tasks: scripts/reports/lesson-refine-tasks__2026-01-26T23-14-45-939Z.md

## Phase 2 — Quiz Pipeline Dry Run (read-only)
- Command:

  npx tsx --env-file=.env.local scripts/quiz-quality-pipeline.ts --course PRODUCTIVITY_2026_EN --min-lesson-score 70 --dry-run

- Output:
  - Latest report: scripts/reports/quiz-quality-pipeline__2026-01-27T00-33-54-209Z.json
  - Latest lesson refine tasks: scripts/reports/quiz-quality-pipeline__2026-01-27T00-33-54-209Z__lesson-refine-tasks.md
  - Latest rewrite failures: scripts/reports/quiz-quality-pipeline__2026-01-27T00-33-54-209Z__rewrite-failures.md

- Latest totals (dry-run):
  - lessonsEvaluated: 30
  - lessonsNeedingRefine: 18
  - lessonsRewritten: 12
  - lessonsFailedRewrite: 0

## Phase 2.1 — Generator Fixes (Code Change, No DB Writes)
- Implemented a dedicated EN generator for `PRODUCTIVITY_2026` Day 1–13 to avoid invalid generic templates and satisfy strict QC.
- Files changed:
  - `scripts/content-based-question-generator.ts`
  - `scripts/quiz-quality-pipeline.ts` (exit cleanly + proper markdown newlines)
  - `scripts/audit-lesson-quality.ts` (exit cleanly + proper markdown newlines)

- Totals (dry-run):
  - courses: 1
  - lessonsEvaluated: 30
  - lessonsNeedingRefine: 18
  - lessonsFailedRewrite: 12
  - lessonsRewritten: 0
  - questionsDeleted: 0
  - questionsInserted: 0

## Notes
- Dry-run must not write to DB.
- Apply step requires explicit confirmation.

## Phase 3 — APPLY Pipeline (DB Writes)
- Command:

  npx tsx --env-file=.env.local scripts/quiz-quality-pipeline.ts --course PRODUCTIVITY_2026_EN --min-lesson-score 70

- Output:
  - Report: scripts/reports/quiz-quality-pipeline__2026-01-27T08-40-56-090Z.json
  - Lesson refine tasks: scripts/reports/quiz-quality-pipeline__2026-01-27T08-40-56-090Z__lesson-refine-tasks.md
  - Rewrite failures: scripts/reports/quiz-quality-pipeline__2026-01-27T08-40-56-090Z__rewrite-failures.md

- Totals (apply):
  - lessonsEvaluated: 30
  - lessonsNeedingRefine: 18
  - lessonsRewritten: 12
  - lessonsFailedRewrite: 0
  - questionsDeleted: 83
  - questionsInserted: 83

- Backups created (per lesson, same stamp as apply run):
  - scripts/quiz-backups/PRODUCTIVITY_2026_EN/*__2026-01-27T08-40-56-090Z.json

## Phase 4 — Post-Apply Verification
- Per-lesson pool summary:
  - scripts/reports/post-apply-summary__PRODUCTIVITY_2026_EN__2026-01-27T08-41-verify.json

- Notes:
  - Days 1–10 and 12–13 now satisfy:
    - total >= 7
    - recall == 0
    - application >= 5
    - option length >= 25 chars
  - Days 11 and 14–30 still contain recall/short options because the lessons are too weak (blocked by lesson quality threshold).

## Phase 5 — Lesson Refinement Preview (Dry Run)
- Goal: Raise lesson quality for Day 11 and 14–30 so the quiz pipeline can rewrite quizzes at strict QC.
- Command (dry-run):

  npx tsx --env-file=.env.local scripts/refine-productivity-2026-en-lessons.ts --course PRODUCTIVITY_2026_EN --from-day 11 --to-day 30

- Output:
  - Report: scripts/reports/lesson-refine-preview__PRODUCTIVITY_2026_EN__2026-01-27T08-46-12-977Z.json

- Result summary:
  - Target lessons: 18 (Day 11 and Day 14–30)
  - All 18 would reach >= 70 (preview shows 100/100 for each).

- Apply command (requires confirmation; DB write + backups):

  npx tsx --env-file=.env.local scripts/refine-productivity-2026-en-lessons.ts --course PRODUCTIVITY_2026_EN --from-day 11 --to-day 30 --apply

## Phase 6 — Lesson Refinement APPLY (DB Writes)
- Command:

  npx tsx --env-file=.env.local scripts/refine-productivity-2026-en-lessons.ts --course PRODUCTIVITY_2026_EN --from-day 11 --to-day 30 --apply

- Output:
  - Report: scripts/reports/lesson-refine-preview__PRODUCTIVITY_2026_EN__2026-01-27T08-50-43-081Z.json
  - Backups: scripts/lesson-backups/PRODUCTIVITY_2026_EN/*__2026-01-27T08-50-43-081Z.json

## Phase 7 — Quiz Pipeline After Refinement (Dry Run)
- Report: scripts/reports/quiz-quality-pipeline__2026-01-27T08-53-00-613Z.json
- Rewrite failures: scripts/reports/quiz-quality-pipeline__2026-01-27T08-53-00-613Z__rewrite-failures.md (none)

## Phase 8 — Quiz Pipeline APPLY After Refinement (DB Writes)
- Report: scripts/reports/quiz-quality-pipeline__2026-01-27T08-53-17-634Z.json
- Backups: scripts/quiz-backups/PRODUCTIVITY_2026_EN/*__2026-01-27T08-53-17-634Z.json

## Phase 9 — Final Verification + Sample
- Verification summary: scripts/reports/post-apply-summary__PRODUCTIVITY_2026_EN__2026-01-27T08-54-verify.json
- Sample quiz question (Day 14): scripts/reports/sample-quiz__PRODUCTIVITY_2026_EN__DAY_14__2026-01-27T08-54.json
