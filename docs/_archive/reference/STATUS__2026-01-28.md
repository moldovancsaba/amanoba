# Amanoba Current Status (Archived Snapshot)

> Archived on 2026-02-05. Current work should live in `docs/product/TASKLIST.md`, `docs/product/ROADMAP.md`, and `docs/product/RELEASE_NOTES.md`.

**Last Updated**: 2026-01-28  
**Version**: 2.9.15  
**Status**: âœ… Production Stable â€” Profile Visibility & Privacy (PV1â€“PV4) and Policy/LocaleLink (POL1,POL3â€“POL6) delivered; open tasks in handover doc

---

## ğŸ¯ Current State Summary

Amanoba has successfully completed **Phases 1, 2, and 3** of the transformation from a game platform to a **30-day learning platform**, and has now integrated **Stripe payment processing** for premium courses. The platform now includes:
- Complete course and lesson data models
- Full admin course builder with rich text editor
- Student course dashboard and enrollment system
- Daily email automation with timezone support
- Email preferences and unsubscribe functionality
- **Stripe payment integration for premium courses**
- **Premium course pricing in admin interface**
- **Payment history tracking**
- **Automatic premium activation on successful payment**
- First production course seeded: "AI 30 Nap" (30-day AI learning course)
- Internationalization (Hungarian default, English support)
- New design system with brand colors and logo
- **Profile Visibility & Privacy (v2.9.15)**: Private/public profile, per-section visibility (about, courses, achievements, certificates, stats), "View as others see it", API 404 for private non-owner; public profile schema in `docs/features/PUBLIC_PROFILE_SCHEMA.md`
- **Policy/LocaleLink (v2.9.15)**: Policy pages use shared layout and brand tokens; LocaleLink sweep done; POL2 (policy message keys) deferred

**Open work**: See `docs/_archive/delivery/2026-01/2026-01-28_HANDOVER_OPEN_TASKS.md` for CCS email localization (CCS-AUDIT-EMAIL-3), POL2 (policy message keys), and Mobile (MOB1â€“MOB8).

---

## âœ… Completed Work

### Google Analytics with Consent Mode v2 âœ… COMPLETE (v2.9.2)

**Status**: GDPR/CCPA compliant analytics tracking fully functional  
**Timeline**: 2026-01-25

#### Analytics & Compliance Components
- âœ… Google Analytics integration with measurement ID `G-53XPWHKJTM`
- âœ… Consent Mode v2 implementation (default consent: denied)
- âœ… Cookie consent banner with granular controls
- âœ… Four consent types: analytics_storage, ad_storage, ad_user_data, ad_personalization
- âœ… Persistent consent storage in localStorage
- âœ… Fully translated in all 11 languages (88 new translations)

#### Course Progress Tracking Fix âœ… COMPLETE (v2.9.2)

**Status**: Course progress properly tracked and restored  
**Timeline**: 2026-01-25

#### Progress Tracking Components
- âœ… `calculateCurrentDay()` helper function for correct progress calculation
- âœ… Lesson completion API recalculates currentDay after completion
- âœ… Lesson fetch API validates and auto-fixes currentDay if out of sync
- âœ… My-courses API calculates currentDay on-the-fly for display
- âœ… Handles out-of-order completion correctly
- âœ… Users taken directly to next uncompleted lesson

### Stripe Payment Integration âœ… COMPLETE (v2.8.0)

**Status**: Core payment system fully functional  
**Timeline**: 2025-01-20

#### Payment System Components
- âœ… PaymentTransaction model for complete audit trail
- âœ… Stripe Checkout integration for secure payments
- âœ… Webhook handler for payment events (success, failure, refund)
- âœ… Payment success handler with verification
- âœ… Payment history API and UI
- âœ… Payment confirmation emails (bilingual)
- âœ… Premium course pricing in admin interface
- âœ… Stripe minimum amount validation
- âœ… Multi-currency support (USD, EUR, HUF, GBP)

#### Admin Features
- âœ… Set courses as premium (requiresPremium checkbox)
- âœ… Set custom pricing per course (amount + currency)
- âœ… Real-time validation with Stripe minimums
- âœ… Auto-adjustment when currency changes

#### User Features
- âœ… Purchase premium courses via Stripe Checkout
- âœ… Automatic premium activation on successful payment
- âœ… View payment history in profile
- âœ… Payment confirmation emails

**Files Created**: 6 new files (models, APIs, utilities)  
**Files Modified**: 8 files (Player model, email service, course pages, profile page)

---

### Phase 1: Foundation & Data Models âœ… COMPLETE

#### 1. Data Models (âœ… Complete)
- âœ… **Course Model** (`app/lib/models/course.ts`)
  - 30-day course structure
  - Points and XP configuration
  - Premium course support
  - Multi-language support (language field + translations)
  - Full TypeScript interfaces

- âœ… **Lesson Model** (`app/lib/models/lesson.ts`)
  - Day-based structure (1-30)
  - HTML/markdown content support
  - Email templates (subject + body)
  - Assessment game linking
  - Multi-language support
  - Unlock conditions

- âœ… **CourseProgress Model** (`app/lib/models/course-progress.ts`)
  - Student progress tracking
  - Current day tracking
  - Completed lessons tracking
  - Assessment results linking
  - Status management

- âœ… **AssessmentResult Model** (`app/lib/models/assessment-result.ts`)
  - Game session â†’ course assessment linking
  - Score and accuracy tracking
  - Insights and recommendations fields

- âœ… **Game Model Extended** (`app/lib/models/Game.ts`)
  - `isAssessment` flag
  - `assessmentConfig` object

- âœ… **Player Model Extended** (`app/lib/models/Player.ts`)
  - `emailPreferences` object
  - Default locale (Hungarian)

#### 2. Email Service (âœ… Complete)
- âœ… Resend integration (`app/lib/email/email-service.ts`)
- âœ… 4 email functions:
  - `sendLessonEmail()` - Daily lesson delivery
  - `sendWelcomeEmail()` - Course enrollment
  - `sendCompletionEmail()` - Course completion
  - `sendReminderEmail()` - Daily reminders
- âœ… Multi-language email support
- âœ… Email preferences checking

#### 3. Internationalization (âœ… Complete)
- âœ… next-intl integration
- âœ… Hungarian as default language
- âœ… English support
- âœ… All pages migrated to `app/[locale]/` structure
- âœ… Core pages translated (signin, dashboard, games)
- âœ… LocaleLink component for navigation
- âœ… Language switcher component
- âœ… Translation files: `messages/hu.json`, `messages/en.json`

#### 4. Design System (âœ… Complete)
- âœ… New brand colors:
  - Black (#000000)
  - Dark Grey (#2D2D2D)
  - White (#FFFFFF)
  - Accent Yellow (#FAB908)
- âœ… Logo component (`components/Logo.tsx`)
- âœ… Logo integrated in signin and dashboard
- âœ… All core pages redesigned with new colors
- âœ… Tailwind config updated
- âœ… Global CSS variables updated

#### 5. Build & Quality (âœ… Complete)
- âœ… Build runs error-free
- âœ… JSON translation files validated
- âœ… TypeScript compilation successful
- âœ… No linter errors
- âœ… Production deployment stable
- âœ… i18n locale handling fixed
- âœ… Routing issues resolved

---

## ğŸ“Š Current Statistics

### Codebase
- **Total Models**: 27 (4 new course-related models)
- **Email Functions**: 4 (lesson, welcome, completion, reminder)
- **Translation Files**: 2 (Hungarian, English) - Comprehensive translations
- **Translated Pages**: All core pages (dashboard, games, courses, admin, etc.)
- **New Components**: 3 (Logo, LocaleLink, RichTextEditor)
- **Admin Pages**: 8 (dashboard, courses, games, achievements, rewards, challenges, players, settings)
- **Student Pages**: 4 (courses catalog, course detail, my-courses, daily lesson viewer)
- **API Routes**: 15+ course-related endpoints

### Database Collections
- **New Collections**: 4 (courses, lessons, course_progress, assessment_results)
- **Extended Collections**: 2 (games, players)
- **Seeded Courses**: 1 (AI_30_NAP - AI 30 Nap course with all 30 lessons)

### Dependencies
- **New**: `resend`, `next-intl`, `@tiptap/react`, `@tiptap/starter-kit`, `@tiptap/extension-placeholder`, `@tiptap/extension-link`, `server-only`
- **Updated**: All existing dependencies

---

## ğŸš§ In Progress

### Phase 4: Assessment Integration
- Game-to-assessment bridge (ready to start)
- Assessment analytics dashboard (pending)

---

## âœ… Phase 2: Course Builder & Student Dashboard (COMPLETE)

### 2.1 Course Builder Admin Interface âœ…
**Completed**: 2025-01-17

**Deliverables**:
- âœ… Admin course management pages (`/admin/courses`, `/admin/courses/new`, `/admin/courses/[courseId]`)
- âœ… 30-day lesson builder interface with TipTap rich text editor
- âœ… Rich text editor for lesson content
- âœ… Course preview functionality
- âœ… Publish/unpublish workflow
- âœ… Assessment game selection and linking
- âœ… Email template editor

### 2.2 Student Course Dashboard âœ…
**Completed**: 2025-01-17

**Deliverables**:
- âœ… Course listing and enrollment (`/courses`, `/courses/[courseId]`)
- âœ… Student course dashboard (`/my-courses`)
- âœ… Daily lesson viewer (`/courses/[courseId]/day/[dayNumber]`)
- âœ… Assessment game integration (game sessions linked to course context)
- âœ… Lesson completion tracking
- âœ… Progress visualization

---

## âœ… Phase 3: Email Automation (COMPLETE)

### 3.1 Daily Email Scheduler âœ…
**Completed**: 2025-01-17

**Deliverables**:
- âœ… Daily lesson email cron job (`/api/cron/send-daily-lessons`)
- âœ… Timezone-aware email scheduling (`app/lib/courses/email-scheduler.ts`)
- âœ… Email delivery tracking (emailSentDays in CourseProgress)
- âœ… Catch-up email logic for missed days
- âœ… Vercel cron configuration

### 3.2 Email Preferences UI âœ…
**Completed**: 2025-01-17

**Deliverables**:
- âœ… Email preferences in Player model
- âœ… Email settings page (`/settings/email`)
- âœ… Unsubscribe functionality (`/api/email/unsubscribe`)
- âœ… Email delivery history tracking

---

## ğŸ“‹ Next Steps: Phase 4

---

## ğŸ¯ Phase 4: Assessment Integration (Weeks 7-8)

### 4.1 Game-to-Assessment Bridge
- Assessment launcher
- Game session â†’ course linking
- Assessment results processing

### 4.2 Assessment Analytics
- Admin analytics dashboard
- Student assessment results view
- Performance insights

---

## ğŸ¯ Phase 5: Gamification Integration (Weeks 9-10)

### 5.1 Course-Specific Achievements
- Course achievement triggers
- Course completion badges

### 5.2 Course Leaderboards
- Course-specific leaderboards
- Leaderboard calculation

---

## ğŸ¯ Phase 6: Polish & Launch (Weeks 11-12)

### 6.1 UI/UX Polish
- Course card designs
- Lesson viewer improvements
- Mobile responsiveness

### 6.2 Documentation & Testing
- Course creation documentation
- End-to-end testing
- Performance optimization

---

## ğŸ”§ Environment Variables Required

### Email Service
```bash
RESEND_API_KEY=re_xxxxx
EMAIL_FROM=noreply@amanoba.com
EMAIL_FROM_NAME=Amanoba Learning
EMAIL_REPLY_TO=support@amanoba.com
```

### Application
```bash
NEXT_PUBLIC_APP_URL=https://amanoba.com
```

---

## ğŸ“ Key Files & Locations

### Models
- `app/lib/models/course.ts` - Course model
- `app/lib/models/lesson.ts` - Lesson model
- `app/lib/models/course-progress.ts` - Progress tracking
- `app/lib/models/assessment-result.ts` - Assessment results

### Email Service
- `app/lib/email/email-service.ts` - Email functions
- `app/lib/email/index.ts` - Exports

### Payment System
- `app/lib/models/payment-transaction.ts` - PaymentTransaction model
- `app/api/payments/create-checkout/route.ts` - Stripe Checkout creation
- `app/api/payments/webhook/route.ts` - Stripe webhook handler
- `app/api/payments/success/route.ts` - Payment success handler
- `app/api/payments/history/route.ts` - Payment history API
- `app/lib/utils/stripe-minimums.ts` - Stripe minimum validation

### i18n
- `i18n.ts` - i18n configuration
- `messages/hu.json` - Hungarian translations
- `messages/en.json` - English translations
- `components/LocaleLink.tsx` - Locale-aware links

### Design
- `components/Logo.tsx` - Logo component
- `tailwind.config.ts` - Brand colors
- `app/globals.css` - CSS variables

---

## âœ… Quality Checks

- âœ… Build: Error-free
- âœ… TypeScript: Compiles successfully
- âœ… Linter: No errors
- âœ… JSON: Valid translation files
- âœ… Models: All indexed and validated

---

## ğŸš€ Ready For

- âœ… Phase 4: Assessment Integration
- âœ… Creating additional courses (seed script available)
- âœ… Multi-language course content
- âœ… Student enrollment and course completion
- âœ… Daily email delivery automation

---

## ğŸ“ Notes

- All existing gamification features remain intact
- Games can still be played outside of courses
- Courses are opt-in feature
- Backward compatible with existing data
- Build is production-ready

---

**Maintained By**: Narimato  
**Next Review**: Onboarding Survey & Email Automation  
**Status**: âœ… Production Stable - Stripe Integration Complete
