/**
 * Seed: B2B Sales 2026 (RU) – Days 1–2
 *
 * What:
 * - Creates (or updates) course `B2B_SALES_2026_30_RU`
 * - Seeds lessons for days 1–2 in Russian
 * - Seeds course-specific quiz questions per lesson
 *
 * Why:
 * - Provide a Russian version of the existing HU/EN Sales course
 * - Ensure it works with the current lesson/quiz runtime:
 *   - Lesson content is rendered as HTML (`dangerouslySetInnerHTML`)
 *   - Quiz pages fetch by `lesson.lessonId` (string), so QuizQuestion.lessonId must match that
 *
 * How to run:
 * - Ensure `.env.local` has `MONGODB_URI` and `DB_NAME=amanoba`
 * - Run: `npx tsx --env-file=.env.local scripts/seed-b2b-sales-ru.ts`
 */

import { config } from 'dotenv';
import { resolve } from 'path';

config({ path: resolve(process.cwd(), '.env.local') });

import mongoose from 'mongoose';
import { Brand, Course, Lesson, QuizQuestion, QuestionDifficulty } from '../app/lib/models';

async function connectDB() {
  const uri = process.env.MONGODB_URI;
  if (!uri) throw new Error('MONGODB_URI missing');

  const dbName = process.env.DB_NAME || 'amanoba';
  await mongoose.connect(uri, { dbName });
  console.log(`✅ Connected to MongoDB (dbName=${dbName})`);
}

const COURSE_ID = 'B2B_SALES_2026_30_RU';
const SOURCE_COURSE = 'B2B_SALES_2026_30_EN';

type LessonSeed = {
  day: number;
  title: string;
  contentHtml: string;
  emailSubject: string;
  emailBodyHtml: string;
  quiz: Array<{ q: string; options: [string, string, string, string]; correct: number }>;
};

const lessonsRu: LessonSeed[] = [
  {
    day: 1,
    title: 'Что означает современная B2B‑продажа в 2026 году',
    contentHtml: `
<h1>Что означает современная B2B‑продажа в 2026 году</h1>
<p><em>Продажи — это помощь в принятии решения и снижение риска, а не “питч”. Сегодня мы задаём правильную рамку на весь курс.</em></p>
<hr />

<h2>Цель дня</h2>
<ul>
  <li>Сформулировать в 1 предложении цель современной B2B‑продажи.</li>
  <li>Распознать 3 типичных мифа о продажах и заменить их рабочими принципами.</li>
  <li>Собрать мини‑метрики недели, чтобы управлять процессом, а не настроением.</li>
  <li>Создать “Карту реальности сделки” для 1 реального лида/аккаунта.</li>
</ul>
<hr />

<h2>Почему это важно</h2>
<ul>
  <li>Неверная ментальная модель → неверные действия → неверные выводы.</li>
  <li>Покупатель хочет принять решение быстрее и безопаснее — не слушать каталог возможностей.</li>
  <li>Рост в B2B строится на исследовании, документации и контроле следующего шага.</li>
</ul>
<hr />

<h2>Объяснение</h2>
<h3>A) Что изменилось к 2026</h3>
<ul>
  <li><strong>Решения стали “многопоточными”</strong>: несколько ролей, несколько критериев, разные риски.</li>
  <li><strong>Покупатель информирован</strong>: он сравнивает, читает отзывы, смотрит демо у конкурентов.</li>
  <li><strong>Цена ошибки выросла</strong>: внедрение влияет на KPI, безопасность, юридические риски и карьеру ЛПР.</li>
  <li><strong>От продавца ждут ясности</strong>: рамка, критерии, план, документация, прогнозирование рисков.</li>
</ul>

<h3>B) Новая роль продавца</h3>
<p><strong>Вы не “убеждаете”. Вы снижаете неопределённость.</strong></p>
<ul>
  <li>Помогаете увидеть проблему, последствия и критерии успеха.</li>
  <li>Строите процесс: что делаем дальше, кто участвует, какие артефакты нужны.</li>
  <li>Делаете риск управляемым: пилот, security‑review, согласование договора, ROI‑кейс.</li>
</ul>

<h3>C) 3 мифа и замена на принцип</h3>
<ul>
  <li><strong>Миф:</strong> “Главное — хорошо презентовать”. <strong>Принцип:</strong> “Главное — хорошо диагностировать и зафиксировать критерии решения”.</li>
  <li><strong>Миф:</strong> “Скидка закрывает сделку”. <strong>Принцип:</strong> “Сделку закрывает ясный next step + снятые риски + подтверждённая ценность”.</li>
  <li><strong>Миф:</strong> “Достаточно говорить с одним человеком”. <strong>Принцип:</strong> “Нужно работать с DMU: бизнес‑ЛПР, пользователи, IT/безопасность, финансы, юристы”.</li>
</ul>
<hr />

<h2>Примеры</h2>
<h3>Пример 1 — “каталог” vs “решение”</h3>
<ul>
  <li><strong>Каталог:</strong> “У нас 40 функций, интеграции, отчёты…”</li>
  <li><strong>Решение:</strong> “Согласуем критерии успеха пилота: (1) время обработки заявки, (2) точность данных, (3) требования ИБ. Затем — план на 2 недели и список участников.”</li>
</ul>

<h3>Пример 2 — управление риском</h3>
<p>Крупный клиент боится “сломать процессы”. Вы предлагаете:</p>
<ul>
  <li>пилот на ограниченном сегменте,</li>
  <li>чек‑лист рисков (юристы/ИБ/IT),</li>
  <li>письменный план внедрения и ответственность сторон.</li>
</ul>
<hr />

<h2>Практика 1 — “Карта реальности сделки” (10 минут)</h2>
<p>Возьмите 1 лид/аккаунт и заполните:</p>
<ul>
  <li><strong>ICP</strong>: какая компания и почему сейчас.</li>
  <li><strong>Гипотеза проблемы</strong>: что болит и чем это подтверждается.</li>
  <li><strong>DMU</strong>: кто влияет (минимум 3 роли).</li>
  <li><strong>Критерий успеха</strong>: как клиент поймёт, что “сработало”.</li>
  <li><strong>Главный риск</strong>: что может остановить сделку.</li>
  <li><strong>Next step</strong>: конкретное действие + дата.</li>
</ul>

<h2>Практика 2 — мини‑метрики недели (5 минут)</h2>
<p>Составьте простую таблицу на неделю:</p>
<ul>
  <li>сколько новых контактов в ICP,</li>
  <li>сколько назначено встреч,</li>
  <li>сколько зафиксировано next step с датой,</li>
  <li>сколько сделок перешло в следующий этап.</li>
</ul>
<hr />

<h2>Подсказка</h2>
<p><strong>Если после разговора нет next step с датой — это не этап, а надежда.</strong> После каждой встречи отправляйте краткий итог (MoM): что согласовано, какие риски, кто что делает и когда.</p>
<hr />

<h2>Доп. материалы (по желанию)</h2>
<ul>
  <li>Википедия (RU) — B2B: <a href="https://ru.wikipedia.org/wiki/B2B" target="_blank" rel="noopener noreferrer">https://ru.wikipedia.org/wiki/B2B</a></li>
  <li>HubSpot — Sales Process Guide: <a href="https://blog.hubspot.com/sales/sales-process" target="_blank" rel="noopener noreferrer">https://blog.hubspot.com/sales/sales-process</a></li>
  <li>Gartner (EN) — материалы по B2B Sales: <a href="https://www.gartner.com/en/sales" target="_blank" rel="noopener noreferrer">https://www.gartner.com/en/sales</a></li>
</ul>
`.trim(),
    emailSubject: 'B2B Sales 2026 (RU) — День 1: современная цель продаж',
    emailBodyHtml: `
<h1>B2B Sales 2026 (RU) — День 1</h1>
<p>Продажи в 2026 — это помощь в принятии решения и снижение риска. Сегодня вы:</p>
<ul>
  <li>зафиксируете правильную ментальную модель,</li>
  <li>замените 3 мифа рабочими принципами,</li>
  <li>создадите “Карту реальности сделки” и мини‑метрики недели.</li>
</ul>
<p>Откройте урок и сделайте практику — это база всего курса.</p>
`.trim(),
    quiz: [
      {
        q: 'Какая формулировка лучше всего описывает цель современной B2B‑продажи?',
        options: [
          'Показать как можно больше функций продукта',
          'Убедить клиента купить через скидку',
          'Помочь клиенту принять решение и снизить риск',
          'Сделать презентацию длиннее конкурентов',
        ],
        correct: 2,
      },
      {
        q: 'Что является признаком “управляемого” процесса после встречи?',
        options: [
          'Есть согласованный следующий шаг с датой и ответственными',
          'Клиент сказал “мы подумаем”',
          'Вы отправили прайс без контекста',
          'Вы добавили сделку в CRM без комментариев',
        ],
        correct: 0,
      },
      {
        q: 'Какой вариант — пример рабочего принципа вместо мифа?',
        options: [
          'Скидка закрывает сделку',
          'Главное — красиво презентовать',
          'Закрывает сделку снятие рисков + подтверждённая ценность + next step',
          'Достаточно говорить с одним человеком',
        ],
        correct: 2,
      },
      {
        q: 'Что должно входить в “Карту реальности сделки” (минимум)?',
        options: [
          'Только бюджет и срок оплаты',
          'Только список функций и скидка',
          'ICP, гипотеза проблемы, DMU, критерий успеха, риск, next step',
          'Только название компании и номер телефона',
        ],
        correct: 2,
      },
    ],
  },
  {
    day: 2,
    title: 'Карта системы B2B‑продаж',
    contentHtml: `
<h1>Карта системы B2B‑продаж</h1>
<p><em>Сегодня вы нарисуете “сквозной маршрут” сделки: от поиска до расширения — и зададите единые определения этапов.</em></p>
<hr />

<h2>Цель дня</h2>
<ul>
  <li>Собрать карту: <strong>sourcing → qualification → discovery → proposal → negotiation → close → expansion</strong>.</li>
  <li>Определить критерии входа/выхода для каждого этапа.</li>
  <li>Сделать одностраничный документ “Sales System Map” для вашей команды/проекта.</li>
</ul>
<hr />

<h2>Почему это важно</h2>
<ul>
  <li>Единый язык снижает хаос: что такое “SQL”, “квалификация”, “успешная диагностика”.</li>
  <li>Без критериев этапы превращаются в мнения, а прогноз — в гадание.</li>
  <li>Карта — фундамент для метрик, автоматизации и обучения новых продавцов.</li>
</ul>
<hr />

<h2>Объяснение</h2>
<h3>Блоки системы</h3>
<ul>
  <li><strong>Sourcing</strong>: источники (inbound, списки, партнёры, события, рефералы).</li>
  <li><strong>Qualification</strong>: быстрый “да/нет” на ICP + триггер + реальная проблема.</li>
  <li><strong>Discovery</strong>: диагноз + критерии успеха + DMU + риски.</li>
  <li><strong>Proposal</strong>: решение под критерии, план внедрения, ROI/бизнес‑кейс, условия.</li>
  <li><strong>Negotiation</strong>: финальные риски (юристы/ИБ/закупки), пакет, сроки, SLA.</li>
  <li><strong>Close</strong>: подпись/оплата/старт, фиксация плана запуска.</li>
  <li><strong>Expansion</strong>: onboarding, adoption, upsell, продление, кейс/реферальная петля.</li>
</ul>

<h3>Критерии этапа: вход и выход</h3>
<p>Чтобы этапы работали, у каждого должны быть:</p>
<ul>
  <li><strong>Вход</strong> (что должно быть известно/согласовано),</li>
  <li><strong>Выход</strong> (какой артефакт/договорённость фиксируем),</li>
  <li><strong>Следующий шаг</strong> (дата + ответственные).</li>
</ul>
<hr />

<h2>Пример “мини‑карты”</h2>
<ul>
  <li><strong>Qualification → вход:</strong> компания в ICP + подтверждённый триггер + контакт роли “пользователь/инициатор”.</li>
  <li><strong>Qualification → выход:</strong> назначена discovery‑встреча (дата) + гипотеза проблемы записана.</li>
  <li><strong>Discovery → выход:</strong> документ с критериями успеха + список DMU + риски + план пилота.</li>
</ul>
<hr />

<h2>Практика 1 — нарисуйте свою карту (15 минут)</h2>
<ol>
  <li>Возьмите лист/доску и нарисуйте 7 блоков системы.</li>
  <li>Для каждого блока напишите 1 фразу “что происходит на этапе”.</li>
  <li>Добавьте метрику этапа (пример: % перехода, средняя длительность, % с next step).</li>
</ol>

<h2>Практика 2 — критерии входа/выхода (10 минут)</h2>
<p>Выберите 2 этапа и пропишите:</p>
<ul>
  <li>вход,</li>
  <li>выход,</li>
  <li>типовой артефакт (MoM, список рисков, бизнес‑кейс, пилот‑план).</li>
</ul>
<hr />

<h2>Подсказка</h2>
<p><strong>Если команда спорит о статусе сделки — значит, у этапа нет критериев.</strong> Критерии должны быть настолько конкретными, чтобы два человека независимо пришли к одному выводу.</p>
<hr />

<h2>Доп. материалы (по желанию)</h2>
<ul>
  <li>HubSpot — Sales Pipeline Stages: <a href="https://blog.hubspot.com/sales/sales-pipeline-stages" target="_blank" rel="noopener noreferrer">https://blog.hubspot.com/sales/sales-pipeline-stages</a></li>
  <li>Википедия (RU) — CRM: <a href="https://ru.wikipedia.org/wiki/CRM" target="_blank" rel="noopener noreferrer">https://ru.wikipedia.org/wiki/CRM</a></li>
</ul>
`.trim(),
    emailSubject: 'B2B Sales 2026 (RU) — День 2: карта системы продаж',
    emailBodyHtml: `
<h1>B2B Sales 2026 (RU) — День 2</h1>
<p>Сегодня вы соберёте “Sales System Map” — карту этапов сделки и критериев входа/выхода.</p>
<ul>
  <li>Согласуете этапы и определения</li>
  <li>Добавите критерии и артефакты</li>
  <li>Сделаете основу для метрик и прогнозирования</li>
</ul>
`.trim(),
    quiz: [
      {
        q: 'Зачем нужна “Sales System Map”?',
        options: [
          'Чтобы заменить работу над рисками красивым дизайном',
          'Чтобы у команды были единые этапы и критерии, а прогноз стал измеряемым',
          'Чтобы увеличить количество этапов до 20',
          'Чтобы скрыть воронку от руководства',
        ],
        correct: 1,
      },
      {
        q: 'Какой набор этапов корректнее всего отражает “сквозной маршрут” B2B‑сделки?',
        options: [
          'Sourcing → Qualification → Discovery → Proposal → Negotiation → Close → Expansion',
          'Реклама → Лайки → Комментарии → Покупка',
          'Скидка → Презентация → Оплата',
          'Созвон → Демо → Демо → Демо',
        ],
        correct: 0,
      },
      {
        q: 'Что является хорошим “выходом” из этапа Qualification?',
        options: [
          'Есть назначенная discovery‑встреча с датой + записана гипотеза проблемы',
          'Вы отправили прайс и ждёте ответа',
          'Клиент поставил “лайк”',
          'Вы добавили лид в Excel без следующего шага',
        ],
        correct: 0,
      },
      {
        q: 'Какой сигнал показывает, что у этапа нет критериев?',
        options: [
          'Команда спорит о статусе сделки и “куда её поставить”',
          'Есть чек‑лист входа/выхода',
          'Есть согласованный следующий шаг',
          'Все артефакты фиксируются письменно',
        ],
        correct: 0,
      },
    ],
  },
  {
    day: 3,
    title: 'Диагностируйте проблемы, чтобы управлять покупателем',
    contentHtml: `
<h1>Диагностика и SPIN для DMU</h1>
<p><em>Разбираемся, как вопросы раскрывают последствия и связывают решение с выгодой клиента.</em></p>
<hr />
<h2>Цель дня</h2>
<ul>
  <li>Освоить SPIN‑подход (Situation, Problem, Implication, Need-Payoff) в 2026 B2B.</li>
  <li>Противостоять мифу “дайте скидку — и всё решится”.</li>
  <li>Определить, какие роли DMU слушают ваши вопросы.</li>
</ul>
<hr />
<h2>Практика</h2>
<ul>
  <li>Составьте 4 вопроса: 2 Problem, 1 Implication, 1 Need-Payoff.</li>
  <li>Напишите, какую роль DMU такие вопросы вовлекают.</li>
  <li>Запишите последствия, которые клиент озвучит после Implication‑вопроса.</li>
</ul>
<hr />
<h2>Пример</h2>
<p>“Problem”: “Сколько времени уходило на ручное согласование?”. “Implication”: “Каждая задержка — потеря KPI + риск штрафа от регулятора”. “Need-Payoff”: “Предложим решение, которое сократит согласование на 35% и выдаст прозрачный регламент”.</p>
<hr />
<h2>Доп. материалы</h2>
<ul>
  <li>SPIN Selling — <a href="https://www.spinselling.com" target="_blank" rel="noopener noreferrer">https://www.spinselling.com</a></li>
  <li>HubSpot — Discovery Questions: <a href="https://blog.hubspot.com/sales/discovery-questions" target="_blank" rel="noopener noreferrer">https://blog.hubspot.com/sales/discovery-questions</a></li>
</ul>
`.trim(),
    emailSubject: 'B2B Sales 2026 (RU) — День 3: вопросы, которые двигают процесс',
    emailBodyHtml: `
<h1>B2B Sales 2026 (RU) — День 3</h1>
<p>Используйте SPIN, чтобы переводить разговор в бизнес‑ценность и связывать решения с рисками.</p>
<ul>
  <li>Сформулируйте 2 Problem, 1 Implication, 1 Need-Payoff</li>
  <li>Привяжите каждый вопрос к роли DMU</li>
  <li>Докажите клиенту, что решая проблему, он уменьшает риск</li>
</ul>
`.trim(),
    quiz: [
      {
        q: 'Что делает Implication‑вопрос?',
        options: [
          'Показывает последствия проблемы и увеличивает срочность',
          'Сразу предлагает скидку',
          'Собирает контактные данные',
          'Переходит к следующей сделке',
        ],
        correct: 0,
      },
      {
        q: 'Какую роль DMU охватывает Need-Payoff?',
        options: [
          'Инициатор/операционный лидер',
          'Юрист',
          'ИТ‑архитектор',
          'Бухгалтер',
        ],
        correct: 0,
      },
      {
        q: 'Какие вопросы нельзя отнести к “Problem”?',
        options: [
          '“Нравится ли вам наш продукт?”',
          '“Сколько времени уходит на согласование?”',
          '“Какие выгоды вы хотите получить?”',
          '“Кто отвечает за безопасность?”',
        ],
        correct: 0,
      },
      {
        q: 'Какой следующий шаг показывает, что Implication сработал?',
        options: [
          'Клиент говорит “мы теряем деньги, это больно” и открывает новую тему',
          'Вы скинули онбординг‑буклет',
          'Сделали отчёт по маркетингу',
          'Перешли к скидке',
        ],
        correct: 0,
      },
    ],
  },
  {
    day: 4,
    title: 'ROI, бизнес‑кейсы и согласование бюджета',
    contentHtml: `
<h1>ROI и бизнес-кейсы</h1>
<p><em>Выходите над “холодной функцией”. Обоснуйте стоимость через экономическую выгоду.</em></p>
<hr />
<h2>Цель дня</h2>
<ul>
  <li>Построить короткий бизнес-кейс: вход — проблема, выход — измеримая ценность.</li>
  <li>Собрать вопросы про сроки внедрения, риск и метрику, которую клиент готов мониторить.</li>
  <li>Подготовить “стоимость риска без решения” и “ценность после внедрения”.</li>
</ul>
<hr />
<h2>Практика</h2>
<ul>
  <li>Опишите один KPI, который вы улучшите (5–10 минут).</li>
  <li>Сделайте таблицу “стимул → риск → выгода”.</li>
</ul>
<hr />
<h2>Пример</h2>
<p>Если документирование ручное и 3 сотрудника тратят 40 часов/неделю, то решение может освободить 120 часов и снизить число ошибок на 18%. Эти цифры превращают разговор в дело.</p>
`.trim(),
    emailSubject: 'B2B Sales 2026 (RU) — День 4: ROI и бюджетный кейс',
    emailBodyHtml: `
<h1>B2B Sales 2026 (RU) — День 4</h1>
<p>Сфокусируйтесь на цифрах: сколько времени, денег и репутации спасает решение.</p>
<ul>
  <li>Постройте короткий бизнес-кейс</li>
  <li>Соберите KPI + риски</li>
  <li>Подготовьте аргументы для финальных ЛПР и закупки</li>
</ul>
`.trim(),
    quiz: [
      {
        q: 'Почему важно считать “стоимость риска”?',
        options: [
          'Чтобы показать, что без проекта клиент теряет больше, чем платит',
          'Чтобы иметь повод попросить скидку',
          'Чтобы сравнить конкурентов по дизайну',
          'Чтобы заполнить Excel',
        ],
        correct: 0,
      },
      {
        q: 'Что должно быть в бизнес-кейсе?',
        options: [
          'Проблема, KPI, план внедрения, измеримая выгода',
          'Только описание продукта',
          'Желание сделать красиво',
          'Ссылка на технический мануал',
        ],
        correct: 0,
      },
      {
        q: 'Какие метрики клиент может измерить сразу?',
        options: [
          'Время, ошибки, satisfaction, adoption',
          'Количество сообщений в чате',
          'Общее время, проведённое на кофе',
          'Цвет логотипа',
        ],
        correct: 0,
      },
      {
        q: 'Когда ещё полезно привести ROI?',
        options: [
          'Когда начинают согласование бюджета и участвуют финдир/закупки',
          'Когда уже запустили проект',
          'Когда нет столько времени',
          'Когда только знакомитесь',
        ],
        correct: 0,
      },
    ],
  },
  {
    day: 5,
    title: 'Стратегии работы с DMU и кто влияет',
    contentHtml: `
<h1>Стратегии работы с DMU и кто влияет</h1>
<p><em>Сегодня вы определите ключевые роли в DMU, поймёте, кто влияет на решение и как поддерживать прозрачность между ними.</em></p>
<hr />

<h2>Цель дня</h2>
<ul>
  <li>Классифицировать роли DMU (инициатор, пользователь, финансовый, юридический, ИТ, ЛПР).</li>
  <li>Установить коммуникационный ритм для каждой роли — кто что ждёт и как мы подтверждаем прогресс.</li>
  <li>Построить “карты заинтересованностей”: какие критерии оценивает каждая роль.</li>
</ul>
<hr />

<h2>Объяснение</h2>
<p>DMU — это не просто список контактов. Это сеть, у которой есть свои KPI, критерии рисков и внутренние “холивары”. Мы ставим прозрачные ожидания для каждой роли.</p>
<h3>Категории ролей</h3>
<ul>
  <li><strong>Инициаторы</strong>: хотят видеть проблему решённой быстро и без сюрпризов.</li>
  <li><strong>Пользователи</strong>: требуют удобства/поддержки.</li>
  <li><strong>Финансы</strong>: оценивает цену риска и возврат.</li>
  <li><strong>Юристы/ИБ</strong>: ждут безопасности, SLA и контрактов.</li>
  <li><strong>ИТ/архитекторы</strong>: ищут интеграцию и совместимость.</li>
  <li><strong>ЛПР</strong>: хочет прогнозируемости и точки контроля.</li>
</ul>
<hr />

<h2>Примеры</h2>
<h3>Роль влияет на вопрос</h3>
<p>Финансы просит ROI и сценарии “что если не внедрим”. Юристы спрашивают про SLA и проверки. Пользователи — об обучении. Мы не отвечаем “всё хорошо”, а кладём в таблицу “роль → активность → доказательство”.</p>
<hr />

<h2>Практика — карты заинтересованностей (15 минут)</h2>
<ul>
  <li>Выберите 3 ключевые роли DMU.</li>
  <li>Напишите, чему каждая роль будет доверять: метрика, критерий или доказательство.</li>
  <li>Запишите, как вы поддерживаете каждую роль: встреча, отчёт, PoC, email.</li>
</ul>
<hr />

<h2>Подсказка</h2>
<p><strong>Не пытайтесь “поймать на скидке”.</strong> Чем точнее вы определите критерии и риски каждой роли, тем быстрее согласуют бюджет и интеграцию.</p>
<hr />

<h2>Доп. материалы</h2>
<ul>
  <li>Forrester — <a href="https://go.forrester.com/research/" target="_blank" rel="noopener noreferrer">https://go.forrester.com/research/</a> (по DMU)</li>
  <li>Harvard Business Review — Influence Map: <a href="https://hbr.org/2019/07/your-dmus-are-changing" target="_blank" rel="noopener noreferrer">https://hbr.org/2019/07/your-dmus-are-changing</a></li>
</ul>
`.trim(),
    emailSubject: 'B2B Sales 2026 (RU) — День 5: кто влияет на решение',
    emailBodyHtml: `
<h1>B2B Sales 2026 (RU) — День 5</h1>
<p>DMU влияет на всё. Сегодня вы:</p>
<ul>
  <li>классифицируете роли и критерии,</li>
  <li>создадите “карты заинтересованностей”,</li>
  <li>поддержите коммуникацию для каждой роли.</li>
</ul>
`.trim(),
    quiz: [
      {
        q: 'Кто контролирует риски безопасности и требует SLA?',
        options: [
          'Пользователь',
          'Финансы',
          'Юристы или ИБ',
          'Маркетинг',
        ],
        correct: 2,
      },
      {
        q: 'Что отличает ЛПР от пользователя?',
        options: [
          'ЛПР фокусируется на “глобальном результате” и прогнозе, пользователь — на удобстве.',
          'Пользователь хочет больше скидок, ЛПР — больше фич.',
          'ЛПР отвечает за ИТ‑интеграции.',
          'Пользователь всегда один и тот же человек.',
        ],
        correct: 0,
      },
      {
        q: 'Какая активность помогает “привязать” роли DMU к прогрессу?',
        options: [
          'Ежедневные MoM с указанием согласованных критериев.',
          'Скидка на следующую покупку.',
          'Отправка длинного презентационного PDF.',
          'Отмена demo с критикой конкурентов.',
        ],
        correct: 0,
      },
      {
        q: 'Что входит в “карту заинтересованностей”?',
        options: [
          'Роль → критерий решения → активность → доказательство.',
          'Только имя человека.',
          'Только отслеживание скидок.',
          'Только технические детали.',
        ],
        correct: 0,
      },
    ],
  },
  {
    day: 6,
    title: 'Переговоры, объективные критерии и “необходимая цена”',
    contentHtml: `
<h1>Переговоры с уважением к объективности</h1>
<p><em>Ваши переговоры выигрывает тот, кто показывает, как решение (не скидка) снижает риск и обеспечивает достижение KPI.</em></p>
<hr />

<h2>Цель дня</h2>
<ul>
  <li>Определить “объективные критерии” для согласования (KPI, безопасность, план внедрения).</li>
  <li>Сформировать “стоимость риска” и “ценность решения” в цифрах.</li>
  <li>Подготовить структуру переговоров: открытие → диагноз → план → следующий шаг.</li>
</ul>
<hr />

<h2>Принципы</h2>
<ul>
  <li><strong>Факт 1:</strong> Решение ценится за измеримую разницу — ваши данные.</li>
  <li><strong>Факт 2:</strong> Вопрос “Нужна ли скидка?” заменяется на “Почему сейчас?” и “Какие риски остаются?”.</li>
  <li><strong>Факт 3:</strong> Согласование — это стратегия вовлечённости DMU + документированный план.</li>
</ul>
<hr />

<h2>Практика — переговорная структура</h2>
<ol>
  <li>Запишите три KPI, которые клиент улучшит (в %/время/ошибки).</li>
  <li>Опишите, как снижается риск: кто отвечает, какие действия.</li>
  <li>Составьте табличку “переговорный сценарий”: вопрос → ответ → следующий шаг.</li>
</ol>
<hr />

<h2>Доп. материалы</h2>
<ul>
  <li>Negotiation Mastery — <a href="https://www.pon.harvard.edu/" target="_blank" rel="noopener noreferrer">https://www.pon.harvard.edu</a></li>
  <li>Sales Hacker — <a href="https://www.saleshacker.com/category/negotiation/" target="_blank" rel="noopener noreferrer">https://www.saleshacker.com</a></li>
</ul>
`.trim(),
    emailSubject: 'B2B Sales 2026 (RU) — День 6: переговоры с объективными критериями',
    emailBodyHtml: `
<h1>B2B Sales 2026 (RU) — День 6</h1>
<p>Объективность — оружие переговоров. Сегодня вы:</p>
<ul>
  <li>зафиксируете KPI и стоимость риска,</li>
  <li>подготовите структуру переговоров,</li>
  <li>покажете, как решение снижает неопределённость.</li>
</ul>
`.trim(),
    quiz: [
      {
        q: 'Чем заменяем вопрос “добавите скидку”?',
        options: [
          'На “почему сейчас?”, “какие риски?”, “какой следующий шаг?”.',
          'На “чего вы боитесь?”',
          'На “покажу демо”.',
          'На “дайте ещё один PDF”.',
        ],
        correct: 0,
      },
      {
        q: 'Что входит в объективный KPI?',
        options: [
          'Время/ошибки/сделки/безопасность, а не “общие ощущения”.',
          'Только количество PDF.',
          'Только цвет интерфейса.',
          'Количество вниманий в звонке.',
        ],
        correct: 0,
      },
      {
        q: 'Что делает таблица “переговорного сценария”?',
        options: [
          'Фиксирует вопросы, ответы и следующий шаг по каждой роли.',
          'Скрывает цену от пользователя.',
          'Предлагает скидку сразу.',
          'Сравнивает конкурентов по логотипу.',
        ],
        correct: 0,
      },
      {
        q: 'Почему “стоимость риска” важна?',
        options: [
          'Показывает, что без решения клиент теряет больше, чем платит.',
          'Чтобы попросить больше скидок.',
          'Чтобы скрывать истинную цену.',
          'Чтобы дольше обсуждать договор.',
        ],
        correct: 0,
      },
    ],
  },
  {
    day: 7,
    title: 'Команда и enablement: как масштабировать успех',
    contentHtml: `
<h1>Команда, enablement и внутренние “послы”</h1>
<p><em>Ваша команда — это оркестр: enablement помогает каждому играть в такт. Сегодня вы фиксируете подход к обучению и передачам знаний.</em></p>
<hr />

<h2>Цель дня</h2>
<ul>
  <li>Создать план надоения знания: как делиться кейсами, инсайтами, статусом.</li>
  <li>Определить, какие документы/чек‑листы нужны для onboarding клиента.</li>
  <li>Согласовать формат “послов” — кто внутри клиента будет продвигать решение.</li>
</ul>
<hr />

<h2>Практика</h2>
<ul>
  <li>Напишите 3 “уплотнённых” навигационных документа: MoM, Risk Log, Next Steps.</li>
  <li>Определите 2 человека внутри клиента, которые будут “послами” проекта.</li>
  <li>Поделитесь планом enablement: кто и когда получит training/session.</li>
</ul>
<hr />

<h2>Доп. материалы</h2>
<ul>
  <li>Sales Enablement PRO — <a href="https://www.salesenablementpro.com/" target="_blank" rel="noopener noreferrer">https://www.salesenablementpro.com</a></li>
  <li>Forrester — Enablement ROI: <a href="https://go.forrester.com/" target="_blank" rel="noopener noreferrer">https://go.forrester.com</a></li>
</ul>
`.trim(),
    emailSubject: 'B2B Sales 2026 (RU) — День 7: enablement и команда',
    emailBodyHtml: `
<h1>B2B Sales 2026 (RU) — День 7</h1>
<p>Enablement ускоряет принятие решения. Сегодня вы:</p>
<ul>
  <li>составите план знаний и документов,</li>
  <li>выберете внутренних послов проекта,</li>
  <li>закрепите форму обучения/документации.</li>
</ul>
`.trim(),
    quiz: [
      {
        q: 'Что помогает команде масштабировать успех?',
        options: [
          'Enablement: четкий план знаний и документы.',
          'Больше скидок каждый день.',
          'Скрытые презентации.',
          'Только CRM-отчеты.',
        ],
        correct: 0,
      },
      {
        q: 'Кто такие “послы” внутри клиента?',
        options: [
          'Люди, которые продвигают проект, снимают возражения и поддерживают команду.',
          'Те, кто требует скидок.',
          'Только ИТ-архитекторы.',
          'Маркетинг, который делает соцсетчатость.',
        ],
        correct: 0,
      },
      {
        q: 'Какие документы нужны для enablement?',
        options: [
          'MoM, Risk Log, Next Steps, Training Materials.',
          'Только прайс-лист.',
          'Только скриншоты.',
          'Ничего не нужно.',
        ],
        correct: 0,
      },
      {
        q: 'Что случится, если enablement нет?',
        options: [
          'Проект тормозит: нет понятных ролей, знаний и “послов”.',
          'Больше референсов.',
          'Все решают по своей интуиции.',
          'Все быстро подписывают контракты.',
        ],
        correct: 0,
      },
    ],
  },
  {
    day: 8,
    title: 'Карты клиентского пути и точки контакта',
    contentHtml: `
<h1>Карты клиентского пути и точки контакта</h1>
<p><em>Сегодня вы выстраиваете пути клиента: кто, когда и как получает ценность — а вы видите ключевые “момент влияния”.</em></p>
<hr />

<h2>Цель дня</h2>
<ul>
  <li>Создать карту пути клиента: discovery → pilot → adoption → expansion.</li>
  <li>Определить ключевые точки контакта и документацию/артефакты, которые подкрепляют решение.</li>
  <li>Построить сигнал: что случится на каждом этапе, если его пропустить.</li>
</ul>
<hr />

<h2>Практика</h2>
<ol>
  <li>Нарисуйте 4 этапа пути (например: discovery, pilot, launch, expansion).</li>
  <li>Рядом — перечислите артефакты (MoM, Pilot Charter, KPI Dashboard, Success Stories).</li>
  <li>Добавьте “симптомы”, которые означают, что этап замедлился (нет next step, нет демонстрации KPI, отсутствие ответственного).</li>
</ol>
<hr />

<h2>Доп. материалы</h2>
<ul>
  <li>McKinsey — Customer Journey Mapping: <a href="https://www.mckinsey.com/business-functions/operations/our-insights" target="_blank" rel="noopener noreferrer">https://www.mckinsey.com</a></li>
  <li>Salesforce — Journey Builder: <a href="https://www.salesforce.com/products/marketing-cloud/journey-builder/" target="_blank" rel="noopener noreferrer">https://www.salesforce.com</a></li>
</ul>
`.trim(),
    emailSubject: 'B2B Sales 2026 (RU) — День 8: карта пути клиента',
    emailBodyHtml: `
<h1>B2B Sales 2026 (RU) — День 8</h1>
<p>Составьте карту пути клиента и определите точки влияния, чтобы чувствовать слабые места.</p>
<ul>
  <li>Проведите mapping discovery → pilot → adoption → expansion.</li>
  <li>Зафиксируйте артефакты/сигналы эффективности.</li>
  <li>Поддержите команду четким планом на каждый этап.</li>
</ul>
`.trim(),
    quiz: [
      {
        q: 'Что делает карта клиентского пути?',
        options: [
          'Показывает этапы, артефакты и сигналы, чтобы управлять прогрессом.',
          'Доказывает, что у нас самая красивая презентация.',
          'Сравнивает цену с конкуренцией.',
          'Отправляет длинный pdf.',
        ],
        correct: 0,
      },
      {
        q: 'Какие этапы вы можете поставить на карту?',
        options: [
          'Discovery → Pilot → Adoption → Expansion.',
          'Cold call → follow-up → small talk.',
          'Meetings → Emails → Discounts.',
          'Постинг в соцсетях → конференция.',
        ],
        correct: 0,
      },
      {
        q: 'Что является сигналом «заморозки» этапа?',
        options: [
          'Нет next step, нет записанных KPI, отсутствие владельца.',
          'Клиент улыбается.',
          'Вы пересылаете презентацию.',
          'Всё идёт по плану.',
        ],
        correct: 0,
      },
      {
        q: 'Какие артефакты нужно фиксировать?',
        options: [
          'MoM, Pilot Charter, KPI Dashboard, Success Stories.',
          'Только логотип клиента.',
          'Только прайс-лист.',
          'Ничего не фиксируем.',
        ],
        correct: 0,
      },
    ],
  },
  {
    day: 9,
    title: 'Референсы, кейсы и путь доверия',
    contentHtml: `
<h1>Референсы, кейсы и путь доверия</h1>
<p><em>Без доверия нет сделки. Сегодня вы собираете кейсы и референсы, которые завершают путь клиента.</em></p>
<hr />

<h2>Цель дня</h2>
<ul>
  <li>Собрать 2 сильных кейса/референса, что покажут результат (С%, время, эффект).</li>
  <li>Определить, как/когда вы делитесь кейсами: email, демо, закрытие.</li>
  <li>Создать “досье доверия”: кто подтверждает, какие метрики, как клиент может проверить.</li>
</ul>
<hr />

<h2>Практика</h2>
<ul>
  <li>Выберите 2 похожих клиента и опишите их реализацию: проблема, решение, результат.</li>
  <li>Запишите, когда отправляете кейс и кто его из DMU видит.</li>
  <li>Сложите “досье” в шаблон: проблема/решение/результат/контакт.</li>
</ul>
<hr />

<h2>Доп. материалы</h2>
<ul>
  <li>Gong.io — Real Deal Scorecards: <a href="https://www.gong.io/" target="_blank" rel="noopener noreferrer">https://www.gong.io</a></li>
  <li>CustomerThink — Reference Selling: <a href="https://customerthink.com/reference-selling/" target="_blank" rel="noopener noreferrer">https://customerthink.com</a></li>
</ul>
`.trim(),
    emailSubject: 'B2B Sales 2026 (RU) — День 9: референсы и доверие',
    emailBodyHtml: `
<h1>B2B Sales 2026 (RU) — День 9</h1>
<p>Сильные кейсы — главный аргумент. Сегодня вы:</p>
<ul>
  <li>описали 2 реальных внедрения,</li>
  <li>создали досье доверия,</li>
  <li>распределили, кто и когда делится кейсами.</li>
</ul>
`.trim(),
    quiz: [
      {
        q: 'Что входит в “досье доверия”?',
        options: [
          'Проблема → решение → результат → контакт/видео/метрики.',
          'Только логотип.',
          'Только pdf.',
          'Пустая страница.',
        ],
        correct: 0,
      },
      {
        q: 'Когда вы делитесь кейсом?',
        options: [
          'В тот момент, когда DMU сомневается, и нужен пример результата.',
          'Когда сам клиент просит скидку.',
          'Только после закрытия сделки.',
          'После каждого звонка без цели.',
        ],
        correct: 0,
      },
      {
        q: 'Для чего нужны референсы?',
        options: [
          'Доказывают, что вы уже решили похожую проблему другим.',
          'Чтобы скрыть цену.',
          'Чтобы отвлечь внимание DMU.',
          'Чтобы увеличить количество встреч.',
        ],
        correct: 0,
      },
      {
        q: 'Что усилит доверие DMU?',
        options: [
          'Результаты с цифрами и доказательствами (видео, интервью).',
          'Только презентация “мы лучшие”.',
          'Сравнение по дизайну.',
          'Только обещания.',
        ],
        correct: 0,
      },
    ],
  },
  {
    day: 10,
    title: 'Планирование следующего квартала и “pipeline hygiene”',
    contentHtml: `
<h1>Pipeline hygiene и план следующего квартала</h1>
<p><em>Запланируйте следующий этап: чистый pipeline, новые прогнозы и привычка обновлять статусы.</em></p>
<hr />

<h2>Цель дня</h2>
<ul>
  <li>Составить “pipeline health check”: какие сделки стоят на чем и почему.</li>
  <li>Определить, какие сделки переносятся, какие надо закрыть и какие требуют внимания.</li>
  <li>Построить прогноз (next 30/60/90 дней) с KPI и рисками.</li>
</ul>
<hr />

<h2>Практика</h2>
<ul>
  <li>Разделите сделки на “ready to close”, “on hold”, “needs more data”.</li>
  <li>Обновите CRM/таблицу: кому нужен follow up, какие документы и кто ответственный.</li>
  <li>Поделитесь прогнозом команды: что будет закрыто в 30/60/90 дней, какие риски.</li>
</ul>
<hr />

<h2>Доп. материалы</h2>
<ul>
  <li>Salesforce — Pipeline Management: <a href="https://www.salesforce.com/resources/" target="_blank" rel="noopener noreferrer">https://www.salesforce.com/resources/</a></li>
  <li>HubSpot — Forecasting Template: <a href="https://www.hubspot.com/" target="_blank" rel="noopener noreferrer">https://www.hubspot.com</a></li>
</ul>
`.trim(),
    emailSubject: 'B2B Sales 2026 (RU) — День 10: pipeline hygiene',
    emailBodyHtml: `
<h1>B2B Sales 2026 (RU) — День 10</h1>
<p>Чистый pipeline — нерв продаж. Сегодня вы:</p>
<ul>
  <li>провели health check,</li>
  <li>обновили статус сделок,</li>
  <li>составили прогноз на 30/60/90 дней.</li>
</ul>
`.trim(),
    quiz: [
      {
        q: 'Что такое “pipeline hygiene”?',
        options: [
          'Систематическое обновление статусов, прогнозов и рисков.',
          'Добавление новых контактов.',
          'Сбор всех презентаций.',
          'Постинг рефералов.',
        ],
        correct: 0,
      },
      {
        q: 'Какой прогноз полезен DMU?',
        options: [
          '30/60/90 дней с KPI и рисками.',
          'Только количество встреч.',
          'Только “уверен, закроется”.',
          'Только эмоциональный отчёт.',
        ],
        correct: 0,
      },
      {
        q: 'Что значит “ready to close”?',
        options: [
          'Следующий шаг согласован, есть критерии, бюджет подтверждён.',
          'Есть открытый вопрос по дизайну.',
          'Вы ждёте скидку.',
          'Клиент не ответил.',
        ],
        correct: 0,
      },
      {
        q: 'Почему нужно делиться прогнозом?',
        options: [
          'Чтобы все знали цели, риски и фокус на ближайшие месяцы.',
          'Чтобы затянуть разговор.',
          'Чтобы показать, что pipeline грязный.',
          'Чтобы создать лишние документы.',
        ],
        correct: 0,
      },
    ],
  },
  {
    day: 11,
    title: 'Метрики и триггеры: как мониторить прогресс',
    contentHtml: `
<h1>Метрики и триггеры: как мониторить прогресс</h1>
<p><em>Сегодня вы поставите системные метрики, которые показывают, когда нужно вмешаться.</em></p>
<hr />

<h2>Цель дня</h2>
<ul>
  <li>Определить 3 метрики, по которым вы будете оценивать сделку (время, риск, поддержка внедрения).</li>
  <li>Создать триггерные сигналы: когда сделки “останавливаются” и что делать.</li>
  <li>Сделать единый мониторинг для команды: shared dashboard или simple table.</li>
</ul>
<hr />

<h2>Практика</h2>
<ol>
  <li>Выберите 3 метрики: воронка, время, KPI.</li>
  <li>Опишите, кто смотрит на метрики и как реагирует на отклонения.</li>
  <li>Привяжите триггер: “если нет QA-задачи в течении 5 дней — звонок ЛПР”.</li>
</ol>
<hr />

<h2>Материалы</h2>
<ul>
  <li>Winning by Design — Pipeline Metrics: <a href="https://winningbydesign.com" target="_blank" rel="noopener noreferrer">https://winningbydesign.com</a></li>
</ul>
`.trim(),
    emailSubject: 'B2B Sales 2026 (RU) — День 11: метрики и триггеры',
    emailBodyHtml: `
<h1>B2B Sales 2026 (RU) — День 11</h1>
<p>Сегодня вы выбираете метрики и триггеры, чтобы видеть прогресс и вовремя вмешаться.</p>
`.trim(),
    quiz: [
      {
        q: 'Что такое триггер?',
        options: [
          'Сигнал, что сделка требует вмешательства.',
          'Еще один документ для клиента.',
          'Скидка.',
          'Реклама.',
        ],
        correct: 0,
      },
      {
        q: 'Какие метрики важны?',
        options: [
          'Время цикла, подтвержденные next step, ROI.',
          'Количество поздравительных писем.',
          'Длина презентации.',
          'Статистика по соцсетям.',
        ],
        correct: 0,
      },
      {
        q: 'Что делать, если триггер сработал?',
        options: [
          'Повторно согласовать next step + уточнить препятствия.',
          'Ждать.',
          'Добавить скидку.',
          'Сменить продукт.',
        ],
        correct: 0,
      },
      {
        q: 'Кто должен видеть метрики?',
        options: [
          'Команда продаж и управляющий проектом.',
          'Только маркетинг.',
          'Только бухгалтер.',
          'Никто.',
        ],
        correct: 0,
      },
    ],
  },
  {
    day: 12,
    title: 'Контраргументы, безопасность и юридическая прозрачность',
    contentHtml: `
<h1>Контраргументы и юридическая прозрачность</h1>
<p><em>Сбалансируйте безопасность и скорость, объясняя, почему ваши процессы прозрачны.</em></p>
<hr />

<h2>Цель дня</h2>
<ul>
  <li>Сформулировать 3 ответа на частые возражения по безопасности/договору.</li>
  <li>Подготовить структуру “документа безопасности”, которую можно показать ИТ/ИБ/юристам.</li>
  <li>Убедиться, что вы показываете риски без паники, но с фактами.</li>
</ul>
<hr />

<h2>Пример</h2>
<p>Когда ИБ просит “доказательства доступности”, вы отправляете чек-лист с SSOP, политики и тестами. Юристы хотят прозрачный SLA — вы указываете ответственных и сроки.</p>
<hr />

<h2>Практика</h2>
<ul>
  <li>Запишите возражения от ИТ, ИБ, юридики и ответьте по метрикам.</li>
  <li>Создайте чек-лист безопасности и process map (кто проверяет, когда обновляются политики).</li>
  <li>Поделитесь документом с ИТ/ИБ — пусть они отметят “готово”.</li>
</ul>
<hr />

<h2>Доп материалы</h2>
<ul>
  <li>OWASP — Security Standards: <a href="https://owasp.org" target="_blank" rel="noopener noreferrer">https://owasp.org</a></li>
  <li>ISO 27001 Overview: <a href="https://www.iso.org" target="_blank" rel="noopener noreferrer">https://www.iso.org/isoiec-27001-information-security.html</a></li>
</ul>
`.trim(),
    emailSubject: 'B2B Sales 2026 (RU) — День 12: безопасность и юридика',
    emailBodyHtml: `
<h1>B2B Sales 2026 (RU) — День 12</h1>
<p>Говорите с безопасностью на их языке: цифры, документы, ответственность.</p>
`.trim(),
    quiz: [
      {
        q: 'Что входит в чек-лист безопасности?',
        options: [
          'SSOP, данные по шифрованию, тесты, ответственные.',
          'Список скидок.',
          'Только логотип.',
          'Слово “безопасно”.',
        ],
        correct: 0,
      },
      {
        q: 'Как отвечать на запрос юристов “почему SLA”?',
        options: [
          'Показывая ответственных, процессы запуска, планы резервирования.',
          'Отправляя длинный PDF.',
          'Снижая цену.',
          'Игнорируя вопрос.',
        ],
        correct: 0,
      },
      {
        q: 'Что важно при контраргументе безопасности?',
        options: [
          'Факты, метрики, ответственные; не эмоции.',
          'Обещания без данных.',
          'Сравнение с конкурентами по дизайну.',
          'Только “мы лучшие”.',
        ],
        correct: 0,
      },
      {
        q: 'Почему важно вовлекать ИБ/ИТ раньше?',
        options: [
          'Чтобы убрать технические вопросы до финального согласования.',
          'Чтобы повысить цену.',
          'Чтобы отложить встречу.',
          'Чтобы показать, что ИТ слабо вовлечено.',
        ],
        correct: 0,
      },
    ],
  },
  {
    day: 13,
    title: 'Ценообразование и value story',
    contentHtml: `
<h1>Ценообразование и value story</h1>
<p><em>Производите value story, а не только цену. Сегодня вы формируете предложение, которое базируется на результатах.</em></p>
<hr />

<h2>Цель дня</h2>
<ul>
  <li>Определить value story: какие KPI клиент улучшит, какие риски снижается.</li>
  <li>Составить “bundle” (функции + сервис + ROI) с понятной стоимостью.</li>
  <li>Привязать значение к бенчмаркам отрасли.</li>
</ul>
<hr />

<h2>Практика</h2>
<ol>
  <li>Запишите Value Story: “Мы сократим X, повысим Y, снизим риск Z”.</li>
  <li>Добавьте стоимость: “это стоит A, но экономит B через C месяцев”.</li>
  <li>Покажите, к какому бенчмарку сравниваете (например, отраслевое исследование).</li>
</ol>
<hr />

<h2>Материалы</h2>
<ul>
  <li>McKinsey — Value Story: <a href="https://www.mckinsey.com" target="_blank" rel="noopener noreferrer">https://www.mckinsey.com</a></li>
  <li>Gartner — Value Framework: <a href="https://www.gartner.com" target="_blank" rel="noopener noreferrer">https://www.gartner.com</a></li>
</ul>
`.trim(),
    emailSubject: 'B2B Sales 2026 (RU) — День 13: value story и цена',
    emailBodyHtml: `
<h1>B2B Sales 2026 (RU) — День 13</h1>
<p>Ценообразование — это рассказ о ценности. Сегодня вы:</p>
<ul>
  <li>представили value story,</li>
  <li>связали цифры с отраслевыми бенчмарками,</li>
  <li>упаковали bundle.</li>
</ul>
`.trim(),
    quiz: [
      {
        q: 'Что такое value story?',
        options: [
          '”Мы сокращаем X, улучшаем Y и снижаем Z”.',
          'Перечисление функций продукта.',
          'Скидка 20%.',
          'Ничего не рассказываем.',
        ],
        correct: 0,
      },
      {
        q: 'Как привязать цену к отрасли?',
        options: [
          'Сравнить с бенчмарками/исследованием и показать разницу.',
          'Сказать “дорого, потому что лучше”.',
          'Сравнивать с конкурирующим сайтом по дизайну.',
          'Не сравнивать ничего.',
        ],
        correct: 0,
      },
      {
        q: 'Что делает “bundle”?',
        options: [
          'Собирает функции + сервис + ROI в прозрачное предложение.',
          'Увеличивает цену без смысла.',
          'Скрывает изменение.',
          'Только демо.',
        ],
        correct: 0,
      },
      {
        q: 'Почему важно назвать срок экономии?',
        options: [
          'Чтобы показать, когда клиент вернёт вложения.',
          'Чтобы отсрочить решение.',
          'Чтобы сбросить цену.',
          'Чтобы заполнить презентацию.',
        ],
        correct: 0,
      },
    ],
  },
];

async function upsertCourse() {
  const source = await Course.findOne({ courseId: SOURCE_COURSE });
  const fallbackBrand = source
    ? null
    : (await Brand.findOne({ slug: 'amanoba' })) || (await Brand.findOne({}));
  if (!source && !fallbackBrand) throw new Error('No brand found to create course');

  let course = await Course.findOne({ courseId: COURSE_ID });
  if (course) {
    console.log('✅ Course already exists, updating...');
    course.name = 'B2B Продажи 2026 — мастер‑класс (30 дней) (RU)';
    course.description =
      '30‑дневная программа по современным B2B‑продажам: системная воронка, работа с DMU, управление рисками и ценностью.';
    course.language = 'ru';
    course.isActive = true;
    course.metadata = {
      ...(course.metadata || {}),
      locale: 'ru',
      parentCourseId: SOURCE_COURSE,
    };
    await course.save();
    return course;
  }

  course = await Course.create({
    courseId: COURSE_ID,
    name: 'B2B Продажи 2026 — мастер‑класс (30 дней) (RU)',
    description:
      '30‑дневная программа по современным B2B‑продажам: системная воронка, работа с DMU, управление рисками и ценностью.',
    language: 'ru',
    thumbnail: source?.thumbnail,
    durationDays: source?.durationDays ?? 30,
    isActive: true,
    requiresPremium: source?.requiresPremium ?? false,
    price: source?.price ?? { amount: 0, currency: 'USD' },
    brandId: source?.brandId ?? fallbackBrand!._id,
    pointsConfig: source?.pointsConfig ?? { completionPoints: 300, lessonPoints: 25, perfectCourseBonus: 200 },
    xpConfig: source?.xpConfig ?? { completionXP: 300, lessonXP: 25 },
    metadata: {
      ...source?.metadata,
      locale: 'ru',
      parentCourseId: SOURCE_COURSE,
    },
  });

  console.log('✅ Created course', course.courseId);
  return course;
}

async function upsertLessons(courseId: mongoose.Types.ObjectId) {
  const sourceCourse = await Course.findOne({ courseId: SOURCE_COURSE });

  for (const lesson of lessonsRu) {
    const lessonId = `${COURSE_ID}_DAY_${lesson.day}`;
    const existing = await Lesson.findOne({ lessonId });

    const baseSource = sourceCourse
      ? await Lesson.findOne({ courseId: sourceCourse._id, dayNumber: lesson.day })
      : null;

    const pointsReward = baseSource?.pointsReward ?? 25;
    const xpReward = baseSource?.xpReward ?? 25;
    const quizConfig =
      baseSource?.quizConfig ?? { enabled: true, successThreshold: 80, questionCount: 4, poolSize: 4, required: true };

    const data = {
      lessonId,
      courseId,
      dayNumber: lesson.day,
      language: 'ru',
      title: lesson.title,
      content: lesson.contentHtml.trim(),
      emailSubject: lesson.emailSubject,
      emailBody: lesson.emailBodyHtml.trim(),
      quizConfig,
      pointsReward,
      xpReward,
      isActive: true,
      displayOrder: lesson.day,
      metadata: {
        estimatedMinutes: 20,
        tags: ['b2b', 'sales', 'ru'],
      },
    };

    if (existing) {
      await Lesson.updateOne({ lessonId }, data);
      console.log(`🔁 Updated lesson ${lessonId}`);
    } else {
      await Lesson.create(data);
      console.log(`✅ Created lesson ${lessonId}`);
    }
  }
}

async function upsertQuizQuestions(courseObjectId: mongoose.Types.ObjectId) {
  for (const lesson of lessonsRu) {
    const lessonDoc = await Lesson.findOne({ lessonId: `${COURSE_ID}_DAY_${lesson.day}` });
    if (!lessonDoc) throw new Error(`Lesson not found for day ${lesson.day}`);

    // IMPORTANT:
    // - Quiz UI fetches/submits by `lesson.lessonId` (string), not by Mongo ObjectId.
    // - We also clean up legacy incorrect seeding where lessonId was stored as lessonDoc._id.toString().
    await QuizQuestion.deleteMany({
      courseId: courseObjectId,
      isCourseSpecific: true,
      lessonId: { $in: [lessonDoc.lessonId, lessonDoc._id.toString()] },
    });

    const questions = lesson.quiz.map((q) => ({
      question: q.q,
      options: q.options,
      correctIndex: q.correct,
      difficulty: QuestionDifficulty.MEDIUM,
      category: 'Course Specific',
      showCount: 0,
      correctCount: 0,
      isActive: true,
      lessonId: lessonDoc.lessonId,
      courseId: courseObjectId,
      isCourseSpecific: true,
      metadata: {
        createdAt: new Date(),
        updatedAt: new Date(),
      },
    }));

    await QuizQuestion.insertMany(questions);
    console.log(`✅ Inserted ${questions.length} quiz questions for day ${lesson.day}`);
  }
}

async function main() {
  await connectDB();
  const course = await upsertCourse();
  await upsertLessons(course._id);
  await upsertQuizQuestions(course._id);
  console.log('🎉 Done');
  await mongoose.disconnect();
}

main().catch((err) => {
  console.error(err);
  process.exit(1);
});
